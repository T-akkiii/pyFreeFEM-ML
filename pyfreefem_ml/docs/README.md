# PyFreeFEM-ML ドキュメント

## 目次

1. [概要](#概要)
2. [コード構成](#コード構成)
3. [実装状況](#実装状況)
4. [共有メモリ機能における問題点](#共有メモリ機能における問題点)
5. [開発ロードマップ](#開発ロードマップ)
6. [使用例](#使用例)
7. [関連ドキュメント](#関連ドキュメント)

## 概要

PyFreeFEM-MLは、Python環境からFreeFEMの強力な有限要素解析機能を利用するためのライブラリです。共有メモリを使用してPython-FreeFEM間でデータをやり取りし、効率的な計算と連携を実現します。

主な特徴：
- 共有メモリを使用した高速なデータ交換
- 多次元配列（行列）のサポート
- WSL環境での動作サポート
- 複雑な有限要素計算とPythonの機械学習機能の連携

## コード構成

プロジェクトは以下の主要コンポーネントから構成されています：

### Pythonライブラリ
- `SharedMemoryManager`: 共有メモリの低レベル操作
- `FreeFEMInterface`: 高レベルなユーザー向けAPI
- `FreeFEMRunner`: FreeFEMスクリプト実行管理
- ユーティリティモジュール: データ型変換、エラー処理など

### FreeFEMコンポーネント
- `mmap-semaphore.so`: 共有メモリ操作のC++プラグイン
- ヘルパーライブラリ: FreeFEMから共有メモリを操作するための関数群

詳細な構成については[コード構成ドキュメント](code_organization.md)を参照してください。

## 実装状況

### 実装済み機能

- 基本的なデータ型のサポート
  - 整数値（int）の読み書き
  - 実数値（double）の読み書き
  - 文字列の読み書き
  - 1次元配列（整数・実数）の読み書き
  - 2次元配列（行列）の基本サポート
- FreeFEMプラグイン
  - 基本的な共有メモリI/O機能
  - 配列操作機能
- WSL対応
  - パス変換機能

### 未実装/改善が必要な機能

- 複合データ型のサポート
- 大規模データの効率的な処理
- 自動メモリ管理の改善
- 高度な同期プリミティブの実装
- エラー処理と診断機能の強化

詳細については[実装状況と課題](implementation_issues.md)と[開発計画](development_plan.md)を参照してください。

## 共有メモリ機能における問題点

現在、共有メモリ機能に関して以下の問題が確認されています：

### 1. プラグインのロード失敗

FreeFEMスクリプト実行時に、`mmap-semaphore.so`プラグインのロードに失敗するケースが発生しています。エラーコード8（共有メモリ操作関連）が報告されます。

### 2. 共有メモリセグメントの解放問題

スクリプト実行中、共有メモリセグメントの解放時にエラーが発生し、メモリリークや不適切なリソース解放が生じる可能性があります。

### 3. WSL環境での問題

WSL環境で実行する際に、パス変換や文字エンコーディングの問題が発生することがあります。

詳細な問題点と対策については[実装状況と課題](implementation_issues.md)を参照してください。

## 開発ロードマップ

### フェーズ1：基本機能の安定化
- FreeFEMプラグインの安定化
- エラーハンドリングの強化
- 既存テストの拡充

### フェーズ2：WSL対応と高度なデータ型
- WSL互換性の強化
- 高度なデータ型のサポート
- 性能最適化

### フェーズ3：ドキュメントとサンプル拡充
- APIリファレンスの作成
- サンプルコードの拡充
- ユーザビリティの向上

詳細なロードマップと実装計画は[開発計画](development_plan.md)と[実装状況と計画](integration_plan.md)を参照してください。

## 使用例

### 基本的な使用方法

```python
import numpy as np
from pyfreefem import FreeFEMInterface

# FreeFEMインターフェースの初期化
ff = FreeFEMInterface(wsl_mode=True, debug=True)

# データを共有メモリに書き込み
data = np.random.rand(100, 2)
ff.write_array(data, "input_data")

# FreeFEMスクリプトの実行
success, stdout, stderr = ff.run_script("my_script.edp")

# 結果の読み取り
result = ff.read_array("result_data", 0, (100,), np.float64)

# リソースの解放
ff.cleanup()
```

より詳細な使用例は[使用例ドキュメント](usage_examples.md)を参照してください。

## 関連ドキュメント

- [実装状況と課題](implementation_issues.md) - 現在の実装状況と課題
- [開発計画](development_plan.md) - 開発フェーズとチェックリスト
- [実装状況と計画](integration_plan.md) - 実装状況と今後の計画
- [コード構成](code_organization.md) - プロジェクトのコード構造
- [使用例](usage_examples.md) - 様々な使用例と説明
- [要件定義](requirements.md) - ライブラリの要件定義 